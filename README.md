# 抗量子加密系统

## 项目简介

抗量子加密系统是一个基于格密码学的综合性安全系统，专注于提供抗量子计算攻击的加密、签名和密钥交换功能。该系统利用格密码的抗量子特性，实现了高安全性、高可靠性的加密通信和身份认证方案。

### 核心功能

1. **身份管理**：基于 Module-LWE 问题生成抗量子密钥对，确保身份的安全性和唯一性
2. **加密通信**：使用格密码实现端到端的安全通信，支持数据加密和解密
3. **数字签名**：基于格的签名方案，实现身份认证和数据完整性验证
4. **P2P 安全通道**：建立抗量子的点对点安全通信通道，支持密钥协商和会话管理
5. **秘密共享**：基于 CRT 算法的秘密分割和重构，支持门限恢复机制

## 项目结构

```
QSP/
├── GUI/             # 用户界面模块
├── data/            # 数据存储目录
│   ├── keys/        # 密钥文件
│   ├── shares/      # 秘密份额
│   └── restored/    # 恢复的数据
├── src/             # 核心源代码
│   ├── crypto_lattice/   # 格密码模块
│   ├── dealer/           # 资产锁定模块
│   ├── network/          # 网络通信模块
│   ├── secret_sharing/   # 秘密共享模块
│   ├── utils/            # 工具函数
│   └── core/            # 核心模块
├── tests/           # 测试代码目录
├── text/            # 测试代码目录
├── main.py          # 主程序入口
├── generate_identity.py  # 身份生成工具
└── requirements.txt # 依赖包列表
```

## 核心模块详解

### 1. 格密码模块 (`src/crypto_lattice/`)

- **keygen.py**：实现密钥生成功能，基于 Module-LWE 问题
  - `KeyGenerator`：系统密钥生成器，支持多方密钥生成
  - `KeyTool`：用户密钥生成工具，支持单用户密钥对生成
- **signer.py**：实现签名生成和验证功能
  - `LatticeSigner`：单用户签名和验证
  - `ThresholdSigner`：门限签名生成
  - `SignatureAggregator`：签名聚合和验证
- **encryptor.py**：实现数据加密和解密功能
  - `LatticeEncryptor`：基于 LWE 的数据加密
- **ntt.py**：实现多项式乘法优化
  - `NTT`：快速数论变换，优化多项式运算
- **utils.py**：提供格密码相关的数学工具函数
  - `LatticeUtils`：格密码数学工具类

### 2. 网络通信模块 (`src/network/`)

- **p2p_manager.py**：实现 P2P 网络管理
  - `P2PManager`：P2P 连接管理，支持 STUN 打洞
- **secure_channel.py**：实现安全通道管理
  - `SecureChannel`：基于格密码的安全通道，支持密钥协商和会话管理
- **rudp.py**：实现可靠 UDP 通信
  - `ReliableUDPSocket`：可靠的 UDP 套接字实现
- **protocol.py**：定义网络通信协议

### 3. 秘密共享模块 (`src/secret_sharing/`)

- **splitter.py**：实现秘密分割功能
  - `ImageCRTSplitter`：基于 CRT 算法的图像秘密分割
- **reconstructor.py**：实现秘密重构功能
  - `ImageCRTReconstructor`：基于 CRT 算法的图像秘密重构
- **scrambler.py**：实现秘密信息的混淆和去混淆
- **math_utils.py**：提供数学工具函数
- **moduli_gen.py**：实现模数生成功能

### 4. 资产锁定模块 (`src/dealer/`)

- **locker.py**：实现资产锁定和分发功能
  - `AssetLocker`：资产锁定器，支持加密份额分发

### 5. 工具模块 (`src/utils/`)

- **data_handler.py**：数据处理工具
- **logger.py**：日志记录工具

### 6. 核心模块 (`src/core/`)

- **recovery_session.py**：恢复会话管理

## 关键技术点

### 1. 抗量子安全

- **格密码算法**：使用基于 Module-LWE 问题的格密码算法，抗量子计算攻击
- **显式承诺**：在签名中包含显式承诺，解决噪声进位导致的验证失败问题
- **松弛验证**：允许签名验证过程中存在一定误差范围，提高验证成功率
- **KEM 密钥封装**：使用密钥封装机制实现安全的会话密钥协商

### 2. P2P 安全通信

- **STUN 打洞**：支持 NAT 穿透，实现 P2P 连接
- **可靠 UDP**：实现可靠的数据传输协议
- **安全通道**：基于格密码的端到端加密通道
- **会话管理**：支持会话密钥的生成和更新

### 3. 秘密共享

- **CRT 算法**：基于中国剩余定理实现秘密分割和重构
- **门限方案**：支持 (t, n) 门限恢复，只需 t 个份额即可恢复原始秘密
- **动态模数**：支持动态生成模数，提高系统的灵活性和安全性

### 4. 数字签名

- **门限签名**：支持多方协作签名，提高系统的安全性和可靠性
- **签名聚合**：实现签名的聚合和验证
- **身份认证**：基于格密码的数字签名，确保身份的真实性和不可伪造性

## 系统要求

- Python 3.9+
- NumPy
- pycryptodome
- customtkinter (GUI)

## 安装与运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行系统

```bash
python main.py
```

### 3. 用户操作流程

#### 3.1 系统初始化

1. **环境准备**
   ```bash
   # 安装依赖
   pip install -r requirements.txt
   ```

2. **启动系统**
   ```bash
   python main.py
   ```

3. **系统界面**
   - 启动后会显示现代化主界面
   - 包含三个核心功能模块：身份管理、资产锁定和授权恢复
   - 界面采用暗色主题，支持标签页切换

#### 3.2 身份管理流程

**目的**：生成抗量子密钥对，用于身份认证和数据加密

**详细步骤**：

1. **进入身份管理页面**
   - 点击 "🪪 身份管理" 标签页
   - 查看当前已存在的身份列表

2. **创建新身份**
   - 在输入框中输入身份别名（例如："alice", "bob", "charlie"）
   - 别名要求：仅包含字母、数字和下划线，长度 3-20 字符
   - 点击 "✨ 铸造新身份" 按钮

3. **密钥生成过程**
   - 系统会自动执行以下操作：
     - 生成 32 字节的随机种子（public_seed）
     - 基于 Module-LWE 问题生成私钥向量 s 和误差向量 e
     - 计算公钥 t = A * s + e
     - 生成抗量子安全的密钥对
   - 生成过程通常需要 1-3 秒

4. **密钥文件保存**
   - 私钥保存为：`data/keys/{alias}.sk`
   - 公钥保存为：`data/keys/{alias}.pk`
   - 文件格式：JSON，包含完整的密钥信息

5. **密钥安全注意事项**
   - ⚠️ **私钥安全**：私钥文件必须妥善保管，丢失即无法恢复
   - ⚠️ **备份建议**：建议将私钥文件备份到安全的离线存储设备
   - ⚠️ **不要分享**：永远不要将私钥文件发送给他人
   - ✅ **公钥分享**：公钥文件可以安全地分享给其他用户

6. **身份管理操作**
   - **设为活跃身份**：点击身份卡片上的 "设为活跃" 按钮
   - **取消活跃身份**：点击 "取消活跃" 按钮恢复未选择状态
   - **刷新列表**：点击 "🔄 刷新列表" 按钮更新身份列表
   - **查看密钥**：密钥文件以 JSON 格式存储，可用文本编辑器查看

#### 3.3 P2P 安全通信测试（这步未完全实现）

**目的**：测试 P2P 安全通道的建立和加密通信功能

**详细步骤**：

1. **运行测试脚本**
   ```bash
   python test_phase2_network.py
   ```

2. **测试流程说明**
   - 系统会启动两个模拟用户：Alice 和 Bob
   - 每个用户都会生成自己的抗量子密钥对
   - Alice 作为发起方，Bob 作为接收方

3. **STUN 打洞过程**
   - Alice 查询 STUN 服务器获取公网 IP 和端口
   - 支持的 STUN 服务器：
     - stun.l.google.com:19302
     - stun1.l.google.com:19302
   - 如果 STUN 失败，自动切换到局域网模式

4. **安全通道建立**
   - Alice 发起与 Bob 的连接
   - 执行加密握手流程：
     - Alice 生成会话密钥（AES-256）
     - 使用 Bob 的公钥加密会话密钥（KEM 封装）
     - Alice 使用自己的私钥对握手数据签名
     - Bob 验证 Alice 的签名
     - Bob 使用自己的私钥解密会话密钥（KEM 解封装）
   - 握手成功后，建立安全通道

5. **加密通信测试**
   - Alice 发送加密消息："Hello Bob! Secure?"
   - Bob 接收并解密消息
   - 显示解密后的内容

6. **测试结果验证**
   - ✅ 签名验证通过：`[Security] 格密码验证通过 (误差: XXXX < XXXX)`
   - ✅ 安全通道建立成功：`[Bob] ✅ 安全通道建立成功！`
   - ✅ 消息类型正确：`[Bob] 收到消息类型: CHAT`
   - ✅ 消息内容正确：`[Bob] 解密内容: {'text': 'Hello Bob! Secure?'}`

7. **故障排查**
   - 如果 STUN 查询失败，检查网络连接
   - 如果签名验证失败，检查密钥生成是否正确
   - 如果端口冲突，关闭其他占用端口的程序

#### 3.4 资产锁定流程

**目的**：将秘密图像分割为多个加密分片，分发给不同的用户，实现安全的资产托管

**详细步骤**：

1. **进入资产锁定页面**
   - 点击 "🔒 资产锁定 (Dealer)" 标签页
   - 查看左侧配置面板和右侧日志区域

2. **配置锁定参数**

   **第一步：选择秘密图像**
   - 点击 "📂 加载秘密图" 按钮
   - 选择要托管的秘密图像文件（支持 PNG、JPG 格式）
   - 按钮会显示 "✅ {文件名}" 表示选择成功

   **第二步：选择公钥目录**
   - 点击 "📂 选择公钥目录" 按钮
   - 选择包含参与者公钥文件的目录（默认为 `data/keys`）
   - 系统会自动检测公钥数量（例如：n=5）
   - 按钮会显示 "✅ {目录名} (n=5)"

   **第三步：选择输出目录**
   - 点击 "📂 选择输出目录" 按钮
   - 选择保存加密分片的目录（默认为 `data/shares`）
   - 按钮会显示 "✅ {目录名}" 表示选择成功

   **第四步：设置份额数量 (n)**
   - 拖动滑块设置份额数量（范围：3-10，默认：5）
   - 份额数量不能超过公钥文件数量
   - 标签会实时显示当前设置：`n = 5`

   **第五步：设置恢复门限 (t)**
   - 拖动滑块设置恢复门限（范围：2-5，默认：3）
   - 门限必须小于份额数量（t < n）
   - 标签会实时显示当前设置：`t = 3`

3. **执行锁定操作**
   - 点击 "🔒 执行锁定 (Lock)" 按钮
   - 系统会在后台线程中执行锁定流程
   - 右侧日志区域会实时显示执行进度

4. **锁定流程详解**

   **阶段 1：公钥收集**
   ```
   [Dealer] 启动资产锁定程序 (PQC加密文件版)
   参与者不足! (公钥数 X < 需要 n)
   ```
   - 系统扫描公钥目录，收集所有 `.pk` 文件
   - 验证公钥数量是否满足 n 的要求
   - 如果公钥数量不足，会提示错误

   **阶段 2：CRT 秘密分割**
   ```
   [Step 2] 正在进行 CRT 秘密分割...
   ```
   - 生成安全的模数序列
   - 将秘密图像分割为 n 个份额
   - 每个份额都是独立的，无法单独恢复秘密

   **阶段 3：抗量子加密**
   ```
   [Step 3] 正在执行抗量子加密并生成分发包...
   -> Encrypting Share #1 for alice...
   -> Encrypting Share #2 for bob...
   ...
   ```
   - 对每个份额进行抗量子加密
   - 使用对应公钥的 LWE 加密算法
   - 只有持有对应私钥的用户才能解密

   **阶段 4：文件存储**
   - 为每个用户创建专属目录
   - 保存加密分片文件：`{user_dir}/secure_share_{i+1}.dat`
   - 文件格式：二进制加密数据

   **阶段 5：生成资产清单**
   ```
   [Step 4] 生成资产清单...
   ✅ 锁定完成! 加密分片已保存至: {output_dir}
   ```
   - 生成资产清单文件：`asset_manifest.json`
   - 记录每个分片的元数据：
     - 分片索引
     - 模数信息
     - 文件路径
     - 分片指纹（哈希值）
     - 归属用户
     - 公钥信息

5. **输出目录结构**
   ```
   data/shares/
   ├── asset_manifest.json          # 总清单
   ├── alice/                       # Alice 的专属目录
   │   ├── asset_manifest.json       # Alice 的清单副本
   │   └── secure_share_1.dat      # Alice 的加密分片
   ├── bob/
   │   ├── asset_manifest.json
   │   └── secure_share_2.dat
   ├── charlie/
   │   ├── asset_manifest.json
   │   └── secure_share_3.dat
   ├── david/
   │   ├── asset_manifest.json
   │   └── secure_share_4.dat
   └── eve/
       ├── asset_manifest.json
       └── secure_share_5.dat
   ```

6. **分发加密分片**
   - 将每个用户的专属目录（如 `alice/`）发送给对应用户
   - 用户收到后，将其放入自己的资产目录
   - 资产清单 `asset_manifest.json` 包含所有分片的信息

7. **安全特性**
   - ✅ **抗量子加密**：使用 LWE 算法，抵抗量子攻击
   - ✅ **权益绑定**：每个分片绑定到特定公钥
   - ✅ **完整性保护**：每个分片都有哈希指纹
   - ✅ **门限控制**：需要 t 个分片才能恢复秘密
   - ✅ **独立存储**：每个用户独立保存自己的分片

8. **故障排查**
   - 如果公钥数量不足，添加更多公钥文件或减少 n 值
   - 如果秘密图像格式不支持，转换为 PNG 或 JPG 格式
   - 如果加密失败，检查公钥文件是否完整
   - 如果输出目录权限不足，选择有写入权限的目录

#### 3.5 授权与恢复流程

**目的**：多个用户协作解密各自的分片，达到门限后重构原始秘密图像

**详细步骤**：

1. **准备阶段**

   **步骤 1：准备资产目录**
   - 确保已收到自己的加密分片目录（如 `alice/`）
   - 将目录放置在合适的位置（如 `data/shares/`）
   - 确保目录中包含：
     - 自己的加密分片文件（`secure_share_X.dat`）
     - 资产清单文件（`asset_manifest.json`）

   **步骤 2：准备私钥文件**
   - 确保私钥文件在 `data/keys/` 目录中
   - 私钥文件格式：`{alias}.sk`
   - 私钥文件必须与公钥文件对应

2. **进入授权与恢复页面**
   - 点击 "🔓 授权与恢复 (User)" 标签页
   - 查看顶部状态栏、配置区域、分片列表和恢复控制区

3. **配置资产位置**
   - 在 "资产位置" 输入框中输入资产目录路径
   - 默认路径：`data/shares`
   - 可以点击 "浏览" 按钮选择目录

4. **配置私钥库**
   - 在 "私钥库" 输入框中输入私钥目录路径
   - 默认路径：`data/keys`
   - 可以点击 "浏览" 按钮选择目录

5. **加载资产清单**
   - 点击 "📂 加载资产清单 (Manifest)" 按钮
   - 选择 `asset_manifest.json` 文件
   - 系统会解析清单并显示分片列表
   - 弹窗显示：`发现 X 个资产碎片 (n=X)。恢复门限: X (t=X)`

6. **设置活跃身份**
   - 切换到 "🪪 身份管理" 标签页
   - 找到自己的身份（如 "alice"）
   - 点击 "设为活跃" 按钮
   - 状态栏显示：`当前身份: 👤 alice`
   - 切换回 "🔓 授权与恢复 (User)" 标签页

7. **执行授权解密**

   **步骤 1：查看分片列表**
   - 滚动查看所有分片的信息
   - 每个分片显示：
     - 分片文件名
     - 归属用户
     - 分片指纹（哈希值前 8 位）
     - 操作按钮或状态

   **步骤 2：识别自己的分片**
   - 找到归属人为当前活跃身份的分片
   - 分片卡片会显示 "✍️ 签名授权" 按钮
   - 其他用户的分片会显示 "🔒 无权操作" 或 "需登录身份"

   **步骤 3：执行授权解密**
   - 点击 "✍️ 签名授权" 按钮
   - 弹出安全确认对话框：
     ```
     安全警告
     
     您正在使用身份 [alice] 对以下资产进行解密和签名：
     
     文件: alice/secure_share_1.dat
     指纹: a1b2c3d4e5f6g7h8...
     
     是否确认授权？
     ```
   - 点击 "是" 确认授权

8. **解密过程详解**

   **阶段 1：读取私钥**
   - 系统从私钥目录读取当前活跃身份的私钥文件
   - 验证私钥文件的完整性和格式

   **阶段 2：查找加密分片文件**
   - 根据资产清单中的文件路径查找加密分片
   - 支持多种路径查找策略：
     - 相对路径拼接
     - 当前目录查找
     - 子目录递归查找

   **阶段 3：读取加密数据**
   - 从加密分片文件中读取二进制加密数据
   - 文件格式：`.dat` 二进制文件

   **阶段 4：抗量子解密**
   - 使用私钥对加密数据进行 LWE 解密
   - 验证解密结果的正确性
   - 如果解密失败，提示："解密失败！私钥错误或数据损坏。"

   **阶段 5：哈希校验**
   - 计算解密后数据的 SHA-256 哈希值
   - 与资产清单中的分片指纹进行比对
   - 如果不匹配，提示："完整性校验失败！(Hash Mismatch)"

   **阶段 6：反序列化**
   - 将解密后的字节数据反序列化为分片对象
   - 验证分片数据格式的正确性

   **阶段 7：添加到授权池**
   - 将解密后的分片添加到内存中的授权池
   - 更新分片列表，显示 "✅ 已授权" 状态
   - 弹窗提示："解密授权成功！"

9. **收集多个授权**
   - 重复步骤 6-8，使用不同的身份授权其他分片
   - 每个用户只能授权自己的分片
   - 需要收集至少 t 个授权分片

10. **进度监控**
    - 查看底部进度条和状态标签
    - 标签显示：`收集进度: X / t (共 n 个份额)`
    - 进度条显示当前收集进度
    - 当达到门限时，"🚀 启动重构 (Reconstruct)" 按钮变为可用状态

11. **启动重构**
    - 当授权分片数量达到门限 t 时
    - 点击 "🚀 启动重构 (Reconstruct)" 按钮
    - 系统会执行 CRT 重构算法

12. **重构过程详解**

    **阶段 1：CRT 重构**
    - 使用收集到的 t 个分片
    - 执行中国剩余定理算法
    - 重构原始秘密图像数据

    **阶段 2：图像保存**
    - 将重构的数据转换为图像数组
    - 保存为 PNG 格式：`data/restored/recovered_secret_final.png`

    **阶段 3：结果展示**
    - 弹窗显示成功信息：
      ```
      重构成功
      
      秘密图像已恢复至:
      C:\Users\...\data\restored\recovered_secret_final.png
      ```
    - 自动打开恢复图像所在目录
    - 可以查看和验证恢复的图像

13. **分布式授权模式（可选）**

    **场景**：多个用户在不同设备上，需要离线授权

    **步骤 1：导出签名文件**
    - 用户 A 在自己的设备上执行授权解密
    - 点击 "📤 导出签名文件" 按钮
    - 确认授权后，选择保存位置
    - 系统生成签名文件：`alice_signature.sig`
    - 将签名文件发送给恢复者

    **步骤 2：导入签名文件**
    - 恢复者在自己的设备上打开 GUI
    - 点击 "📥 导入签名文件" 按钮
    - 选择收到的签名文件
    - 系统验证签名文件的有效性
    - 将授权分片添加到授权池

    **步骤 3：收集足够的签名**
    - 重复步骤 1-2，收集至少 t 个签名文件
    - 每个签名文件来自不同的用户

    **步骤 4：启动重构**
    - 当收集到足够的签名文件后
    - 点击 "🚀 启动重构 (Reconstruct)" 按钮
    - 执行重构并恢复秘密图像

14. **安全特性**
    - ✅ **身份验证**：只有私钥持有者才能解密自己的分片
    - ✅ **完整性保护**：哈希校验确保数据未被篡改
    - ✅ **门限控制**：需要 t 个授权才能恢复
    - ✅ **抗量子安全**：使用 LWE 算法保护分片
    - ✅ **分布式支持**：支持离线签名和文件导入

15. **故障排查**
    - 如果找不到加密分片文件，手动选择文件位置
    - 如果解密失败，检查私钥文件是否正确
    - 如果哈希校验失败，检查数据是否被篡改
    - 如果重构失败，确保收集到足够的授权分片
    - 如果 GUI 无法打开恢复目录，手动查看 `data/restored/` 目录

#### 3.6 密钥生成工具（测试步骤之一，可以不执行）

**目的**：使用命令行工具快速生成身份密钥

**详细步骤**：

1. **运行密钥生成脚本**
   ```bash
   python generate_identity.py
   ```

2. **生成过程**
   - 系统会自动生成密钥对
   - 显示生成的密钥信息
   - 保存到默认目录

3. **输出示例**
   ```
   [KeyTool] 正在初始化格参数 (N=256, Q=8380417)...
   [KeyTool] 采样高熵私钥向量与误差项...
   [KeyTool] 执行 LWE 矩阵运算 (t = As + e)...
   密钥对已生成：
   公钥: my_identities/user_1.pk
   私钥: my_identities/user_1.sk
   ```

4. **批量生成**
   - 可以修改脚本实现批量生成
   - 适用于测试和演示场景

#### 3.7 签名验证测试（可选）

**目的**：测试格密码签名系统的正确性和可靠性

**详细步骤**：

1. **运行签名验证测试**
   ```bash
   python tests/test_signature_verification.py
   ```

2. **测试流程**
   - 初始化密钥生成器和聚合器
   - 生成 5 个参与者的密钥对
   - 执行多方协作签名：
     - 阶段 1：生成承诺
     - 阶段 2：生成响应
     - 阶段 3：聚合响应
   - 验证最终签名

3. **测试结果**
   - ✅ 承诺生成成功
   - ✅ 响应生成成功
   - ✅ 签名验证成功
   - 显示误差值和验证结果

4. **性能指标**
   - 密钥生成时间
   - 签名生成时间
   - 签名验证时间
   - 内存使用情况

#### 3.8 网络功能测试（可选）

**目的**：测试网络通信模块的各项功能

**详细步骤**：

1. **P2P 连接测试**
   ```bash
   python test_phase2_network.py
   ```
   - 测试 STUN 打洞
   - 测试 P2P 连接建立
   - 测试安全通道建立
   - 测试加密消息传输

2. **安全通道测试**
   - 测试密钥协商
   - 测试签名验证
   - 测试数据加密/解密
   - 测试会话管理

3. **RUDP 可靠性测试**
   - 测试数据包重传
   - 测试顺序保证
   - 测试丢包恢复

#### 3.9 常见问题解决

**问题 1：密钥生成失败**
- 检查依赖包是否正确安装
- 检查 Python 版本是否 >= 3.9
- 检查是否有足够的磁盘空间

**问题 2：STUN 查询失败**
- 检查网络连接
- 检查防火墙设置
- 尝试使用不同的 STUN 服务器

**问题 3：签名验证失败**
- 检查密钥文件是否完整
- 检查密钥文件是否被篡改
- 重新生成密钥对

**问题 4：P2P 连接失败**
- 检查端口是否被占用
- 检查防火墙是否阻止连接
- 尝试使用不同的端口

**问题 5：GUI 无法启动**
- 检查 customtkinter 是否正确安装
- 检查系统是否支持 GUI
- 尝试使用命令行工具替代

**问题 6：资产锁定失败**
- 检查公钥文件数量是否足够（>= n）
- 检查秘密图像格式是否支持（PNG、JPG）
- 检查输出目录是否有写入权限
- 检查公钥文件是否完整且格式正确

**问题 7：找不到加密分片文件**
- 检查资产目录是否正确
- 检查分片文件是否在正确的子目录中
- 尝试手动选择文件位置
- 检查文件路径是否与资产清单一致

**问题 8：解密授权失败**
- 检查私钥文件是否与公钥文件对应
- 检查私钥文件是否完整且未损坏
- 检查加密分片文件是否被篡改
- 确认当前活跃身份是否正确

**问题 9：哈希校验失败**
- 检查加密分片文件是否被修改
- 检查资产清单是否与分片文件匹配
- 重新获取原始加密分片文件
- 检查数据传输过程中是否损坏

**问题 10：重构失败**
- 检查是否收集到足够的授权分片（>= t）
- 检查授权分片是否来自不同的用户
- 检查 CRT 重构算法的参数是否正确
- 检查恢复目录是否有写入权限

**问题 11：签名文件导入失败**
- 检查签名文件格式是否正确（JSON）
- 检查签名文件是否完整
- 检查签名文件是否来自可信来源
- 检查签名文件是否已过期或重复

**问题 12：进度条不更新**
- 检查是否成功加载资产清单
- 检查是否设置了活跃身份
- 检查是否成功执行授权解密
- 刷新页面或重启 GUI

## 安全性说明

1. **抗量子安全**：系统使用基于格密码的算法，能够抵抗量子计算机的攻击
2. **参数选择**：系统使用安全的格密码参数，提供高安全级别
3. **私钥保护**：私钥仅保存在本地，丢失即丧失资产所有权
4. **数据完整性**：通过哈希校验确保数据的完整性
5. **防重放攻击**：每个恢复会话生成唯一的会话 ID，防止重放攻击
6. **门限控制**：只有 t 个授权用户才能恢复资产，确保资产的安全性和可控性

## 测试

系统提供了完整的测试套件，位于 `tests/` 和 `text/` 目录下：

- **tests/test_lattice.py**：测试格密码模块的功能
- **tests/test_signature_verification.py**：测试签名验证功能
- **tests/test_crt.py**：测试秘密共享模块的功能
- **tests/test_stego.py**：测试图像隐写模块的功能（已废弃）
- **text/test_lattice_system.py**：测试格密码系统的签名验证功能
- **text/test_ntt.py**：测试多项式运算模块的功能
- **text/test_phase3.py**：测试系统综合功能
- **test_phase1_backend.py**：测试后端功能
- **test_phase2_network.py**：测试网络通信功能
- **test_security_fails.py**：测试安全性验证

## 性能优化

1. **多项式乘法**：使用 NTT 变换优化多项式乘法性能
2. **并行计算**：签名生成和验证过程可考虑使用并行计算加速
3. **内存优化**：大型数据处理时可考虑分块处理，减少内存占用

## 未来展望

1. **硬件加速**：探索使用 GPU 加速格密码运算
2. **多模态资产**：支持音频、视频等其他类型的数据
3. **区块链集成**：将资产清单上链，提高系统的透明度和可信度
4. **量子安全增强**：研究和集成最新的后量子密码算法
5. **网络优化**：优化 P2P 网络的连接稳定性和传输效率

## 依赖包

- numpy>=1.23.5
- scipy>=1.10.1
- pycryptodome>=3.18.0
- customtkinter>=5.0.0
- pillow>=9.5.0

## 已实现模块

### 核心加密模块
- ✅ **格密码模块** (`src/crypto_lattice/`)
  - 密钥生成 (`keygen.py`)
  - 数字签名 (`signer.py`)
  - 数据加密 (`encryptor.py`)
  - 多项式运算 (`ntt.py`)
  - 数学工具 (`utils.py`)

### 秘密共享模块
- ✅ **秘密共享模块** (`src/secret_sharing/`)
  - 秘密分割 (`splitter.py`)
  - 秘密重构 (`reconstructor.py`)
  - 数据混淆 (`scrambler.py`)
  - 数学工具 (`math_utils.py`)
  - 模数生成 (`moduli_gen.py`)

### 资产管理模块
- ✅ **资产锁定模块** (`src/dealer/`)
  - 资产锁定 (`locker.py`)

### 工具和核心模块
- ✅ **工具模块** (`src/utils/`)
  - 数据处理 (`data_handler.py`)
  - 日志记录 (`logger.py`)
- ✅ **核心模块** (`src/core/`)
  - 恢复会话管理 (`recovery_session.py`)

### 用户界面模块
- ✅ **GUI 模块** (`GUI/`)
  - 现代化界面 (`app_modern.py`)
  - 传统界面 (`app.py`)

### 测试和工具
- ✅ **测试模块** (`tests/`, `text/`)
  - 格密码测试
  - 签名验证测试
  - 秘密共享测试
  - 网络通信测试
- ✅ **工具脚本**
  - 主程序入口 (`main.py`)
  - 身份生成 (`generate_identity.py`)
  - 网络测试 (`test_phase2_network.py`)




### 待实现功能
### 网络通信模块
- ❌ **P2P 网络模块** (`src/network/`)
- ❌ **区块链集成**：资产清单上链功能
- ❌ **多模态支持**：音频、视频等非图像数据支持
- ❌ **硬件加速**：GPU 加速格密码运算
- ❌ **高级网络功能**：多节点网络、路由发现等
- ❌ **移动端支持**：移动应用版本
- ❌ **Web 界面**：基于 Web 的用户界面

## 许可证

MIT License

## 联系方式

如有问题或建议，请联系项目维护者。

---

*抗量子加密系统 - 保护数据安全，抵御量子威胁*